/*! JTaro.js v0.2.0 ~ (c) 2016 Author:BarZu Git:https://github.com/chjtx/JTaro */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.JTaro=n()}(this,function(){"use strict";function t(){return Object.create({add:function(t,n){this[t]=n},remove:function(t){delete this[t]},run:function(){for(var t in this)this.hasOwnProperty(t)&&"function"==typeof this[t]&&this[t]()}})}var n,e,o;document.addEventListener("touchstart",function(t){n=t,o=t.timeStamp,e=!!/^AUDIO|BUTTON|VIDEO|SELECT|INPUT|TEXTAREA$/.test(t.target.tagName)},!0),document.addEventListener("touchmove",function(){e=!0},!0),document.addEventListener("touchend",function(t){if(!e&&t.timeStamp-o<300){t.preventDefault(),t.stopPropagation();var i=new MouseEvent("click",{bubbles:!0,cancelable:!0});return document.activeElement.blur(),n.target.dispatchEvent(i),!1}},!0);var i=Object.create(null);return i.beforeEnter=t(),i.afterEnter=t(),i.beforeLeave=t(),i.install=function(t,n){function e(t,n){var e=t.options.beforeEnter;i.beforeEnter.run(),"function"==typeof e?e.call(i,function(t){n(t)})&&n():n()}function o(n){var e=t.options.components[n.jtaro_tag].options.afterEnter;i.afterEnter.run(),"function"==typeof e&&e.call(n,i.params)}function a(n,e){var o=t.options.components[n.$parent.jtaro_tag].options.beforeLeave;i.beforeLeave.run(),"function"==typeof o?o.call(n,function(){e()})&&e():e()}function r(t,n){var e=t.$el,a=e.previousElementSibling;i.method&&i.method.call(t,t),i.sliding=!0,n.utils.moveTo(e,m,0),setTimeout(function(){a&&n.utils.moveTo(a,-m*i.options.distance,0,i.options.duration,function(){var t=a.previousElementSibling;t&&(t.style.display="none")}),n.utils.moveTo(e,0,0,i.options.duration,function(){i.sliding=!1,o(t)})},0)}function s(t,n,e){var o=t.nextElementSibling;i.sliding=!0,o&&n.utils.moveTo(o,m,0,i.options.duration,e),n.utils.moveTo(t,0,0,i.options.duration,function(){i.sliding=!1;var n=t.previousElementSibling;n&&(n.style.display="block")})}function l(t,n,e,i){var a=t.length;a-1>i&&s(n[a-2],e,function(){t.splice(a-1),n[a-1].parentNode.removeChild(n[a-1]),setTimeout(function(){l(t,n,e,i)},0)}),a-1===i&&o(u(t[i]))}function d(t){var n=t.split("&"),e={};return n.forEach(function(t){var n=t.split("=");e[n[0]]=n[1]}),e}function u(t){for(var n=i.vm.$children,e=0,o=n.length;e<o;e++)if(n[e].jtaro_tag===t)return n[e]}function c(t,n){var e=t.replace("#!","").split("?")[0],o=i.vm.$data.views,a=i.views.indexOf(e),s=u(e);a===-1?(o.indexOf(e)===-1?o.push(e):(i.vm.$el.appendChild(s.$el),r(s,n)),i.views.push(e)):(i.method&&i.method.call(s,s),l(i.views,i.vm.$el.childNodes,n,a))}function p(){m=window.innerWidth}var f=document.getElementById("jtaro_style");f||(f=document.createElement("style"),f.id="jtaro_style",f.innerHTML="html,body{height:100%;padding:0;margin:0}#jtaro_app{position:relative;width:100%;height:100%;overflow:hidden}.jtaro-view{position:absolute;width:100%;height:100%;overflow:hidden;background:#fff}",document.head.appendChild(f));var v={template:'<div style="text-align:center;padding-top:100px">404 Page not found</div>'},m=window.innerWidth;n=n||{},i.params=null,i.views=[],i.version="0.2.0",i.options={JRoll:n.JRoll||window.JRoll,el:n.el||"#jtaro_app",default:n.default||"home",distance:n.distance||.3,duration:n.duration||200};var h={props:["view"],data:function(){return{jtaro_tag:this.view}},render:function(n){return n(t.options.components[this.view]||v)},mounted:function(){r(this,i.options.JRoll)}};t.component("jt-view",h),t.prototype.postMessage=function(n,e){var o=u(e),i=t.options.components[e],a=i?i.options.onMessage:null;o&&a&&a.call(o.$children[0],{message:n,origin:this.$parent.jtaro_tag})},t.prototype.go=function(n,o){i.sliding||a(this,function(){var a=n.replace("#!",""),r=a.split("?");e(t.options.components[r[0]],function(t){t?i.method=t:i.method=null,r[1]?i.params=d(r[1]):o?i.params=o:i.params=null,"number"==typeof n?window.history.go(n):window.location.hash="!"+n})})},i.vm=new t({el:i.options.el,data:{views:[]},template:'<div id="'+i.options.el.replace("#","")+'"><jt-view class="jtaro-view" v-for="view in views" :view="view"></jt-view></div>'}),window.addEventListener("hashchange",function(){c(window.location.hash,i.options.JRoll)}),window.addEventListener("resize",p),window.addEventListener("orientationchange",p),function(){var n=window.location.hash,o=t.options.components[i.options.default||n.replace("#!","").split("?")[0]];o&&e(o,function(t){t?i.method=t:i.method=null,""===n?window.location.hash="!"+i.options.default:c(n,i.options.JRoll)})}()},i});