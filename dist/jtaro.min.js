/*! JTaro.js v0.4.7 ~ (c) 2016 Author:BarZu Git:https://github.com/chjtx/JTaro */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.JTaro=n()}(this,function(){"use strict";function t(t){return t.replace(/\/|\\/g,"__")}function n(){return Object.create({add:function(t,n){this[t]=n},remove:function(t){delete this[t]},run:function(){for(var t in this)this.hasOwnProperty(t)&&"function"==typeof this[t]&&this[t]()}})}var e=Object.create(null);return e.beforeEnter=n(),e.afterEnter=n(),e.beforeLeave=n(),e.tools={isEmptyObject:function(t){for(var n in t)if(t.hasOwnProperty(n))return!1;return!0}},e.install=function(n,o){function i(t,n){var o=t.options.beforeEnter;e.beforeEnter.run(),"function"==typeof o?o.call(e,function(t){n(t)})&&n():n()}function r(o){var i=n.options.components[t(o.jtaro_tag)].options.afterEnter;e.afterEnter.run(),"function"==typeof i&&i.call(o.$children[0],e.tools.isEmptyObject(e.params)?null:e.params),e.params=null}function s(o,i){var r=n.options.components[t(o.$parent.jtaro_tag)].options.beforeLeave;e.beforeLeave.run(),"function"==typeof r?r.call(o,function(){i()})&&i():i()}function a(t,n){var o=t.$el,i=o.previousElementSibling;e.method&&e.method.call(t.$children[0],t.$children[0]),e.sliding=!0,n.utils.moveTo(o,m,0),setTimeout(function(){i&&n.utils.moveTo(i,-m*e.options.distance,0,e.options.duration,function(){var t=i.previousElementSibling;t&&(t.style.display="none")}),n.utils.moveTo(o,0,0,1===e.views.length?0:e.options.duration,function(){e.sliding=!1,r(t)})},0)}function l(t,n,o){var i=t.nextElementSibling;e.sliding=!0,i&&n.utils.moveTo(i,m,0,e.options.duration,o),n.utils.moveTo(t,0,0,e.options.duration,function(){e.sliding=!1;var n=t.previousElementSibling;n&&(n.style.display="block")})}function d(t,n,o,i){var s=t.length;s-1>i&&l(n[s-2],o,function(){t.splice(s-1),e.history.splice(s-1),window.sessionStorage.setItem("JTaro.history",JSON.stringify(e.history)),n[s-1].parentNode.removeChild(n[s-1]),setTimeout(function(){d(t,n,o,i)},0)}),s-1===i&&r(u(t[i]))}function p(t){var n=t.split("&"),e={};return n.forEach(function(t){var n=t.split("=");e[n[0]]=n[1]}),e}function u(t){for(var n=e.vm.$children,o=0,i=n.length;o<i;o++)if(n[o].jtaro_tag===t)return n[o]}function c(t,n){var o=t.replace("#","").split("?")[0],i=e.vm.$data.views,r=e.views.indexOf(o),s=u(o);r===-1?(i.indexOf(o)===-1?i.push(o):(e.vm.$el.appendChild(s.$el),a(s,n)),e.views.push(o),e.history.push({view:o,url:t.replace("#",""),params:e.tools.isEmptyObject(e.params)?null:e.params}),window.sessionStorage.setItem("JTaro.history",JSON.stringify(e.history))):(e.method&&e.method.call(s,s),d(e.views,e.vm.$el.childNodes,n,r))}function f(){m=window.innerWidth}function h(){var o=window.location.hash,r=n.options.components[t(o.replace("#","").split("?")[0]||e.options.default)];r&&i(r,function(t){if(t?e.method=t:e.method=null,""===o)window.location.hash=e.options.default;else{var n=o.split("?");e.params={},n[1]&&(e.params=p(n[1])),c(o,e.options.JRoll)}})}var v=document.getElementById("jtaro_style");v||(v=document.createElement("style"),v.id="jtaro_style",v.innerHTML="html,body{height:100%;padding:0;margin:0}#jtaro_app{position:relative;width:100%;height:100%;overflow:hidden}.jtaro-view{position:absolute;width:100%;height:100%;overflow:hidden;background:#fff;}",document.head.appendChild(v));var m=window.innerWidth;o=o||{},e.views=[],e.history=[],e.version="0.4.7",e.options={JRoll:o.JRoll||window.JRoll,el:o.el||"#jtaro_app",default:o.default||"home",distance:o.distance||.3,duration:o.duration||200};var w={props:["view"],data:function(){return{jtaro_tag:this.view}},render:function(e){return e(n.options.components[t(this.view)])},mounted:function(){a(this,e.options.JRoll)}};n.component("jt-view",w),n.prototype.postMessage=function(e,o){var i=u(o),r=n.options.components[t(o)],s=r?r.options.onMessage:null;i&&s&&s.call(i.$children[0],{message:e,origin:this.$parent.jtaro_tag})},n.prototype.go=function(o,r){function a(t){for(;!t.$el.classList.contains("jtaro-view");)t.$parent&&(t=t.$parent);return t}e.sliding||s(a(this),function(){var s=o.replace("#",""),a=s.split("?");i(n.options.components[t(a[0])],function(t){var n,i,s=e.views.indexOf(a[0]);if(~s&&(s=1-(e.views.length-s),s&&(o=s)),t?e.method=t:e.method=null,e.params={},r&&(e.params=r),a[1]){i=p(a[1]);for(n in i)i.hasOwnProperty(n)&&(e.params[n]=i[n])}"number"==typeof o?window.history.go(o):window.location.hash=o})})},e.vm=new n({el:e.options.el,data:{views:[]},template:'<div id="'+e.options.el.replace("#","")+'"><jt-view class="jtaro-view" v-for="view in views" :view="view" :key="view"></jt-view></div>'}),window.addEventListener("hashchange",function(){c(window.location.hash,e.options.JRoll)}),window.addEventListener("resize",f),window.addEventListener("orientationchange",f);var g=window.sessionStorage.getItem("JTaro.history");e.afterEnter.add("__autoLoadHistoryPages__",function(){if(g&&g.length>1){var t=u(g.shift().view).$children[0];setTimeout(function(){t.go(g[0].url,g[0].params)},0)}}),g&&(g=JSON.parse(g)).length>1?window.history.go(1-g.length):h()},e});