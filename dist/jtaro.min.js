/*! JTaro.js v0.6.1 ~ (c) 2016-2018 Author:BarZu Git:https://github.com/chjtx/JTaro */
!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):t.JTaro=o()}(this,function(){"use strict";function t(t){return t.replace(/\/|\\/g,"__")}function o(){return Object.create({add:function(t,o){this[t]=o},remove:function(t){delete this[t]},run:function(){for(var t in this)this.hasOwnProperty(t)&&"function"==typeof this[t]&&this[t]()}})}var n=Object.create(null);return n.beforeEnter=o(),n.afterEnter=o(),n.beforeLeave=o(),n.tools={isEmptyObject:function(t){for(var o in t)if(t.hasOwnProperty(o))return!1;return!0}},n.install=function(o,i){function e(t,o){var i=t.options.beforeEnter;n.beforeEnter.run(),"function"==typeof i?i.call(n,function(t){o(t)})&&o():o()}function s(i){var e=o.options.components[t(i.jtaro_tag)].options.afterEnter;n.afterEnter.run(),"function"==typeof e&&e.call(i.$children[0],n.tools.isEmptyObject(n.params)?null:n.params),n.params=null}function r(){for(var t=n.history.length,o=window.location.hash.replace("#","").split("?")[0];t--;)if(n.history[t].url===o)return void(window.location.hash=m);window.history.back()}function a(i,e){var s=o.options.components[t(i.jtaro_tag)].options.beforeLeave;n.beforeLeave.run(),"function"==typeof s?(y=!0,s.call(i.$children[0],function(){y=!1,e()},r)):e()}function l(t,o){var i=t.$el,e=i.previousElementSibling;n.method&&n.method.call(t.$children[0],n.tools.isEmptyObject(n.params)?null:n.params),n.sliding=!0,i.style[o.utils.TSD]="0ms",i.style[o.utils.TSF]="translate("+v+"px, 0px) translateZ(0px)",setTimeout(function(){i.style[o.utils.TSD]="",e&&(e.style[o.utils.TSF]="translate("+-v*n.options.distance+"px, 0px) translateZ(0px)",setTimeout(function(){var t=e.previousElementSibling;t&&(t.style.display="none")},n.options.duration)),i.style[o.utils.TSF]="translate(0px, 0px) translateZ(0px)",setTimeout(function(){n.sliding=!1,s(t)},1===n.views.length?0:n.options.duration)},100)}function p(t,o,i){var e=t.nextElementSibling;n.sliding=!0,e&&(e.style[o.utils.TSF]="translate("+v+"px, 0px) translateZ(0px)",setTimeout(i,n.options.duration)),t.style[o.utils.TSF]="translate(0px, 0px) translateZ(0px)",setTimeout(function(){n.sliding=!1;var o=t.previousElementSibling;o&&(o.style.display="block")},n.options.duration)}function u(t,o,i,e){var r=t.length;r-1>e&&p(o[r-2],i,function(){t.splice(r-1),n.history.splice(r-1),window.sessionStorage.setItem("JTaro.history",JSON.stringify(n.history)),o[r-1].parentNode.removeChild(o[r-1]),setTimeout(function(){u(t,o,i,e)},0)}),r-1===e&&s(c(t[e]))}function d(t){var o=t.split("&"),n={};return o.forEach(function(t){var o=t.split("=");n[o[0]]=o[1]}),n}function c(t){for(var o=n.vm.$children,i=0,e=o.length;i<e;i++)if(o[i].jtaro_tag===t)return o[i]}function f(t,o){var i=t.replace("#","").split("?")[0],e=n.vm.$data.views,s=n.views.indexOf(i),r=c(i);m=i,-1===s?(-1===e.indexOf(i)?e.push(i):(n.vm.$el.appendChild(r.$el),l(r,o)),n.views.push(i),n.history.push({view:i,url:t.replace("#",""),params:n.tools.isEmptyObject(n.params)?null:n.params}),window.sessionStorage.setItem("JTaro.history",JSON.stringify(n.history))):u(n.views,n.vm.$el.childNodes,o,s)}function h(){v=window.innerWidth}function w(i){var s=window.location.hash;if(i&&window.location.hash.substr(1)!==n.options.default)return void(window.location.hash=n.options.default);if(""===s)return void(window.location.hash=n.options.default);var r=s.replace("#","").split("?")[0],a=o.options.components[t(r)];a&&e(a,function(t){n.method=t||null;var o=s.split("?");n.params={},o[1]&&(n.params=d(o[1])),f(s,n.options.JRoll)})}var v=window.innerWidth,m="",y=!1;i=i||{},n.views=[],n.history=[],n.version="0.6.1",n.options={JRoll:i.JRoll||window.JRoll,el:i.el||"#jtaro_app",default:i.default||"home",distance:isNaN(i.distance)?.2:Number(i.distance),duration:isNaN(i.duration)?300:Number(i.duration)};var g=document.getElementById("jtaro_style");g||(g=document.createElement("style"),g.id="jtaro_style",g.innerHTML="html,body{height:100%;padding:0;margin:0}#jtaro_app{position:relative;width:100%;height:100%;overflow:hidden}.jtaro-view{position:absolute;width:100%;height:100%;overflow:hidden;background:#fff;-webkit-transition:transform "+n.options.duration+"ms ease-out;transition:transform "+n.options.duration+"ms ease-out;}",document.head.appendChild(g));var b={props:["view"],data:function(){return{jtaro_tag:this.view}},render:function(n){return n(o.options.components[t(this.view)])},mounted:function(){l(this,n.options.JRoll)}};o.component("jt-view",b),o.prototype.postMessage=function(n,i){var e=c(i),s=o.options.components[t(i)],r=s?s.options.onMessage:null;e&&r&&r.call(e.$children[0],{message:n,origin:this.$parent.jtaro_tag})},o.prototype.go=function(t,o){if(!n.sliding){if(!isNaN(t))return void window.history.go(t);var i,e,s=t.replace("#",""),r=s.split("?"),a=n.views.indexOf(r[0]);if(~a&&(a=1-(n.views.length-a))&&(t=a),n.params={},o&&(n.params=o),r[1]){e=d(r[1]);for(i in e)e.hasOwnProperty(i)&&(n.params[i]=e[i])}"number"==typeof t?window.history.go(t):window.location.hash=t}},n.vm=new o({el:n.options.el,data:{views:[]},template:'<div id="'+n.options.el.replace("#","")+'"><jt-view class="jtaro-view" v-for="view in views" :view="view" :key="view"></jt-view></div>'}),window.addEventListener("hashchange",function(){function i(t){n.method=t||null,f(window.location.hash,n.options.JRoll)}if(y)return void(y=!1);if(""===window.location.hash)return window.sessionStorage.getItem("JTaro.history"),void(window.location.hash=n.options.default);var s=window.location.hash.replace("#","").split("?")[0];m?a(c(m),function(){e(o.options.components[t(s)],i)}):e(o.options.components[t(s)],i)}),window.addEventListener("resize",h),window.addEventListener("orientationchange",h);var j=null;""===window.location.hash?window.sessionStorage.removeItem("JTaro.history"):(j=window.sessionStorage.getItem("JTaro.history"),n.afterEnter.add("__autoLoadHistoryPages__",function(){if(j&&j.length>1){var t=c(j.shift().view).$children[0];setTimeout(function(){t.go(j[0].url,j[0].params)},4)}})),j?(j=JSON.parse(j)).length>1?window.history.go(1-j.length):w():w(1)},n});