/*! JTaro.js v0.5.5 ~ (c) 2016-2018 Author:BarZu Git:https://github.com/chjtx/JTaro */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.JTaro=n()}(this,function(){"use strict";function t(t){return t.replace(/\/|\\/g,"__")}function n(){return Object.create({add:function(t,n){this[t]=n},remove:function(t){delete this[t]},run:function(){for(var t in this)this.hasOwnProperty(t)&&"function"==typeof this[t]&&this[t]()}})}var o=Object.create(null);return o.beforeEnter=n(),o.afterEnter=n(),o.beforeLeave=n(),o.tools={isEmptyObject:function(t){for(var n in t)if(t.hasOwnProperty(n))return!1;return!0}},o.install=function(n,e){function i(t,n){var e=t.options.beforeEnter;o.beforeEnter.run(),"function"==typeof e?e.call(o,function(t){n(t)})&&n():n()}function s(e){var i=n.options.components[t(e.jtaro_tag)].options.afterEnter;o.afterEnter.run(),"function"==typeof i&&i.call(e.$children[0],o.tools.isEmptyObject(o.params)?null:o.params),o.params=null}function r(e,i){var s=n.options.components[t(e.jtaro_tag)].options.beforeLeave;o.beforeLeave.run(),"function"==typeof s?s.call(e.$children[0],function(){i()})&&i():i()}function a(t,n){var e=t.$el,i=e.previousElementSibling;o.method&&o.method.call(t.$children[0],t.$children[0]),o.sliding=!0,e.style[n.utils.TSD]="0ms",e.style[n.utils.TSF]="translate("+w+"px, 0px) translateZ(0px)",setTimeout(function(){e.style[n.utils.TSD]="",i&&(i.style[n.utils.TSF]="translate("+-w*o.options.distance+"px, 0px) translateZ(0px)",setTimeout(function(){var t=i.previousElementSibling;t&&(t.style.display="none")},o.options.duration)),e.style[n.utils.TSF]="translate(0px, 0px) translateZ(0px)",setTimeout(function(){o.sliding=!1,s(t)},1===o.views.length?0:o.options.duration)},100)}function l(t,n,e){var i=t.nextElementSibling;o.sliding=!0,i&&(i.style[n.utils.TSF]="translate("+w+"px, 0px) translateZ(0px)",setTimeout(e,o.options.duration)),t.style[n.utils.TSD]="0ms",t.style[n.utils.TSF]="translate(0px, 0px) translateZ(0px)",setTimeout(function(){t.style[n.utils.TSD]="",o.sliding=!1;var e=t.previousElementSibling;e&&(e.style.display="block")},o.options.duration)}function u(t,n,e,i){var r=t.length;r-1>i&&l(n[r-2],e,function(){t.splice(r-1),o.history.splice(r-1),window.sessionStorage.setItem("JTaro.history",JSON.stringify(o.history)),n[r-1].parentNode.removeChild(n[r-1]),setTimeout(function(){u(t,n,e,i)},0)}),r-1===i&&s(d(t[i]))}function p(t){var n=t.split("&"),o={};return n.forEach(function(t){var n=t.split("=");o[n[0]]=n[1]}),o}function d(t){for(var n=o.vm.$children,e=0,i=n.length;e<i;e++)if(n[e].jtaro_tag===t)return n[e]}function c(t,n){var e=t.replace("#","").split("?")[0],i=o.vm.$data.views,s=o.views.indexOf(e),r=d(e);v=e,-1===s?(-1===i.indexOf(e)?i.push(e):(o.vm.$el.appendChild(r.$el),a(r,n)),o.views.push(e),o.history.push({view:e,url:t.replace("#",""),params:o.tools.isEmptyObject(o.params)?null:o.params}),window.sessionStorage.setItem("JTaro.history",JSON.stringify(o.history))):u(o.views,o.vm.$el.childNodes,n,s)}function f(){w=window.innerWidth}function h(e){var s=window.location.hash;if(e&&window.location.hash.substr(1)!==o.options.default)return void(window.location.hash=o.options.default);if(""===s)return void(window.location.hash=o.options.default);var r=s.replace("#","").split("?")[0],a=n.options.components[t(r)];a&&i(a,function(t){o.method=t||null;var n=s.split("?");o.params={},n[1]&&(o.params=p(n[1])),c(s,o.options.JRoll)})}var w=window.innerWidth,v="";e=e||{},o.views=[],o.history=[],o.version="0.5.5",o.options={JRoll:e.JRoll||window.JRoll,el:e.el||"#jtaro_app",default:e.default||"home",distance:isNaN(e.distance)?.2:Number(e.distance),duration:isNaN(e.duration)?300:Number(e.duration)};var m=document.getElementById("jtaro_style");m||(m=document.createElement("style"),m.id="jtaro_style",m.innerHTML="html,body{height:100%;padding:0;margin:0}#jtaro_app{position:relative;width:100%;height:100%;overflow:hidden}.jtaro-view{position:absolute;width:100%;height:100%;overflow:hidden;background:#fff;-webkit-transition:transform "+o.options.duration+"ms ease-out;transition:transform "+o.options.duration+"ms ease-out;}",document.head.appendChild(m));var y={props:["view"],data:function(){return{jtaro_tag:this.view}},render:function(o){return o(n.options.components[t(this.view)])},mounted:function(){a(this,o.options.JRoll)}};n.component("jt-view",y),n.prototype.postMessage=function(o,e){var i=d(e),s=n.options.components[t(e)],r=s?s.options.onMessage:null;i&&r&&r.call(i.$children[0],{message:o,origin:this.$parent.jtaro_tag})},n.prototype.go=function(t,n){if(!o.sliding){if(!isNaN(t))return void window.history.go(t);var e,i,s=t.replace("#",""),r=s.split("?"),a=o.views.indexOf(r[0]);if(~a&&(a=1-(o.views.length-a))&&(t=a),o.params={},n&&(o.params=n),r[1]){i=p(r[1]);for(e in i)i.hasOwnProperty(e)&&(o.params[e]=i[e])}"number"==typeof t?window.history.go(t):window.location.hash=t}},o.vm=new n({el:o.options.el,data:{views:[]},template:'<div id="'+o.options.el.replace("#","")+'"><jt-view class="jtaro-view" v-for="view in views" :view="view" :key="view"></jt-view></div>'}),window.addEventListener("hashchange",function(){function e(t){o.method=t||null,c(window.location.hash,o.options.JRoll)}if(""===window.location.hash)return window.sessionStorage.getItem("JTaro.history"),void(window.location.hash=o.options.default);var s=window.location.hash.replace("#","").split("?")[0];v?r(d(v),function(){i(n.options.components[t(s)],e)}):i(n.options.components[t(s)],e)}),window.addEventListener("resize",f),window.addEventListener("orientationchange",f);var g=null;""===window.location.hash?window.sessionStorage.removeItem("JTaro.history"):(g=window.sessionStorage.getItem("JTaro.history"),o.afterEnter.add("__autoLoadHistoryPages__",function(){if(g&&g.length>1){var t=d(g.shift().view).$children[0];setTimeout(function(){t.go(g[0].url,g[0].params)},4)}})),g?(g=JSON.parse(g)).length>1?window.history.go(1-g.length):h():h(1)},o});