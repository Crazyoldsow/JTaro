/*! JTaro.js v0.3.1 ~ (c) 2016 Author:BarZu Git:https://github.com/chjtx/JTaro */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.JTaro=n()}(this,function(){"use strict";function t(t){return t.replace(/\/|\\/g,"__")}function n(){return Object.create({add:function(t,n){this[t]=n},remove:function(t){delete this[t]},run:function(){for(var t in this)this.hasOwnProperty(t)&&"function"==typeof this[t]&&this[t]()}})}var e,o,i;document.addEventListener("touchstart",function(t){e=t,i=t.timeStamp,o=!!/^AUDIO|BUTTON|VIDEO|SELECT|INPUT|TEXTAREA$/.test(t.target.tagName)},!0),document.addEventListener("touchmove",function(){o=!0},!0),document.addEventListener("touchend",function(t){if(!o&&t.timeStamp-i<300){t.preventDefault(),t.stopPropagation();var n=new MouseEvent("click",{bubbles:!0,cancelable:!0});return document.activeElement.blur(),e.target.dispatchEvent(n),!1}},!0);var a=Object.create(null);return a.beforeEnter=n(),a.afterEnter=n(),a.beforeLeave=n(),a.install=function(n,e){function o(t,n){var e=t.options.beforeEnter;a.beforeEnter.run(),"function"==typeof e?e.call(a,function(t){n(t)})&&n():n()}function i(e){var o=n.options.components[t(e.jtaro_tag)].options.afterEnter;a.afterEnter.run(),"function"==typeof o&&o.call(e,a.params)}function r(e,o){var i=n.options.components[t(e.$parent.jtaro_tag)].options.beforeLeave;a.beforeLeave.run(),"function"==typeof i?i.call(e,function(){o()})&&o():o()}function s(t,n){var e=t.$el,o=e.previousElementSibling;a.method&&a.method.call(t,t),a.sliding=!0,n.utils.moveTo(e,h,0),setTimeout(function(){o&&n.utils.moveTo(o,-h*a.options.distance,0,a.options.duration,function(){var t=o.previousElementSibling;t&&(t.style.display="none")}),n.utils.moveTo(e,0,0,a.options.duration,function(){a.sliding=!1,i(t)})},0)}function l(t,n,e){var o=t.nextElementSibling;a.sliding=!0,o&&n.utils.moveTo(o,h,0,a.options.duration,e),n.utils.moveTo(t,0,0,a.options.duration,function(){a.sliding=!1;var n=t.previousElementSibling;n&&(n.style.display="block")})}function d(t,n,e,o){var a=t.length;a-1>o&&l(n[a-2],e,function(){t.splice(a-1),n[a-1].parentNode.removeChild(n[a-1]),setTimeout(function(){d(t,n,e,o)},0)}),a-1===o&&i(c(t[o]))}function u(t){var n=t.split("&"),e={};return n.forEach(function(t){var n=t.split("=");e[n[0]]=n[1]}),e}function c(t){for(var n=a.vm.$children,e=0,o=n.length;e<o;e++)if(n[e].jtaro_tag===t)return n[e]}function p(t,n){var e=t.replace("#/","").split("?")[0],o=a.vm.$data.views,i=a.views.indexOf(e),r=c(e);i===-1?(o.indexOf(e)===-1?o.push(e):(a.vm.$el.appendChild(r.$el),s(r,n)),a.views.push(e)):(a.method&&a.method.call(r,r),d(a.views,a.vm.$el.childNodes,n,i))}function f(){h=window.innerWidth}var v=document.getElementById("jtaro_style");v||(v=document.createElement("style"),v.id="jtaro_style",v.innerHTML="html,body{height:100%;padding:0;margin:0}#jtaro_app{position:relative;width:100%;height:100%;overflow:hidden}.jtaro-view{position:absolute;width:100%;height:100%;overflow:hidden;background:#fff}",document.head.appendChild(v));var h=window.innerWidth;e=e||{},a.params=null,a.views=[],a.version="0.3.1",a.options={JRoll:e.JRoll||window.JRoll,el:e.el||"#jtaro_app",default:e.default||"home",distance:e.distance||.3,duration:e.duration||200};var m={props:["view"],data:function(){return{jtaro_tag:this.view}},render:function(e){return e(n.options.components[t(this.view)])},mounted:function(){s(this,a.options.JRoll)}};n.component("jt-view",m),n.prototype.postMessage=function(e,o){var i=c(o),a=n.options.components[t(o)],r=a?a.options.onMessage:null;i&&r&&r.call(i.$children[0],{message:e,origin:this.$parent.jtaro_tag})},n.prototype.go=function(e,i){a.sliding||r(this,function(){var r=e.replace("#/",""),s=r.split("?");o(n.options.components[t(s[0])],function(t){var n=a.views.indexOf(s[0]);~n&&(n=1-a.views.length-n,n&&(e=n)),t?a.method=t:a.method=null,s[1]?a.params=u(s[1]):i?a.params=i:a.params=null,"number"==typeof e?window.history.go(e):window.location.hash="/"+e})})},a.vm=new n({el:a.options.el,data:{views:[]},template:'<div id="'+a.options.el.replace("#","")+'"><jt-view class="jtaro-view" v-for="view in views" :view="view"></jt-view></div>'}),window.addEventListener("hashchange",function(){p(window.location.hash,a.options.JRoll)}),window.addEventListener("resize",f),window.addEventListener("orientationchange",f),function(){var e=window.location.hash,i=n.options.components[t(e.replace("#/","").split("?")[0]||a.options.default)];i&&o(i,function(t){t?a.method=t:a.method=null,""===e?window.location.hash="/"+a.options.default:p(e,a.options.JRoll)})}()},a});